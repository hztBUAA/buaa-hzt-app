"use strict";(self["webpackChunkbuaa_hzt"]=self["webpackChunkbuaa_hzt"]||[]).push([[346],{346:function(e,a,t){t.r(a),t.d(a,{default:function(){return x}});var i=t(641),n=t(3751),l=t(3416),s=t(3892),o=t(4189),r=t(1606),c=t(697),d=t(3813),u=t(6756),p=t(5526),m=t(9669),h=t(7009),v=t(7254),g=t(236),f=t(6106),b=t(105),y=t(3948);const k={class:"map-container mb-4"},P={key:0,class:"d-flex justify-center align-center flex-column",style:{height:"300px"}},M={class:"d-flex justify-center my-4"},A={class:"d-flex justify-center pa-4"};function _(e,a,t,_,w,L){return(0,i.uX)(),(0,i.Wv)(d.I,null,{default:(0,i.k6)((()=>[(0,i.bF)(o.J,{class:"mb-4"},{default:(0,i.k6)((()=>[(0,i.bF)(r.r,{class:"d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{start:"",icon:"mdi-map-marker",class:"mr-2"}),a[3]||(a[3]=(0,i.Lk)("h1",null,"附近地点",-1))])),_:1}),(0,i.bF)(c.O,null,{default:(0,i.k6)((()=>[(0,i.Lk)("div",k,[w.mapLoaded?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",P,[(0,i.bF)(f.x,{indeterminate:"",color:"primary",size:"64"}),a[4]||(a[4]=(0,i.Lk)("div",{class:"mt-4"},"地图加载中...",-1))])),a[5]||(a[5]=(0,i.Lk)("div",{id:"map-container",style:{height:"300px","border-radius":"8px"}},null,-1))])])),_:1})])),_:1}),(0,i.bF)(o.J,{class:"mb-4"},{default:(0,i.k6)((()=>[(0,i.bF)(c.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(u.L,{align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(p.B,{cols:"12",sm:"8"},{default:(0,i.k6)((()=>[(0,i.bF)(y.W,{modelValue:w.searchQuery,"onUpdate:modelValue":a[0]||(a[0]=e=>w.searchQuery=e),label:"搜索附近地点",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-magnify",clearable:"",onKeyup:(0,n.jR)(L.searchPlaces,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),(0,i.bF)(p.B,{cols:"12",sm:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(b.d4,{modelValue:w.selectedCategory,"onUpdate:modelValue":a[1]||(a[1]=e=>w.selectedCategory=e),items:w.categories,label:"分类",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-filter-variant"},null,8,["modelValue","items"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(o.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(r.r,{class:"d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{start:"",icon:"mdi-format-list-bulleted",class:"mr-2"}),a[6]||(a[6]=(0,i.eW)(" 附近地点列表 "))])),_:1}),w.loading?((0,i.uX)(),(0,i.Wv)(c.O,{key:0},{default:(0,i.k6)((()=>[(0,i.Lk)("div",M,[(0,i.bF)(f.x,{indeterminate:"",color:"primary"})])])),_:1})):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(h.x8,{lines:"two"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(L.filteredPlaces,((e,a)=>((0,i.uX)(),(0,i.Wv)(v.g,{key:a,title:e.name,subtitle:`${e.distance||"未知距离"} · ${e.category||e.type}`},{prepend:(0,i.k6)((()=>[(0,i.bF)(l.y,{color:"primary",icon:L.getCategoryIcon(e.category||e.type)},null,8,["icon"])])),append:(0,i.k6)((()=>[(0,i.bF)(s.D,{icon:"mdi-directions",variant:"text",color:"primary",onClick:a=>L.getDirections(e)},null,8,["onClick"])])),_:2},1032,["title","subtitle"])))),128))])),_:1}),(0,i.Lk)("div",A,[(0,i.bF)(g.l,{modelValue:w.page,"onUpdate:modelValue":[a[2]||(a[2]=e=>w.page=e),L.handlePageChange],length:Math.ceil(L.filteredPlaces.length/w.pageSize),rounded:"circle",width:"auto",class:"pagination-container"},null,8,["modelValue","length","onUpdate:modelValue"])])],64))])),_:1})])),_:1})}t(8992),t(4520),t(3949),t(1454);var w={data(){return{mapLoaded:!1,searchQuery:"",selectedCategory:"全部",categories:["全部","餐厅","咖啡店","超市","公园","学校","图书馆"],loading:!1,page:1,pageSize:6,map:null,geolocation:null,currentPosition:null,nearbyPlaces:[],mockPlaces:[{name:"北航食堂",distance:"200米",category:"餐厅",location:[116.351462,39.980476]},{name:"星巴克咖啡",distance:"350米",category:"咖啡店",location:[116.349784,39.98231]},{name:"学生活动中心",distance:"500米",category:"学校",location:[116.353103,39.979854]},{name:"知春路地铁站",distance:"800米",category:"交通",location:[116.347854,39.976549]},{name:"北航图书馆",distance:"400米",category:"图书馆",location:[116.350678,39.981236]},{name:"五道口购物中心",distance:"1.2公里",category:"购物",location:[116.338963,39.991255]}]}},computed:{filteredPlaces(){let e=this.nearbyPlaces.length>0?this.nearbyPlaces:this.mockPlaces;if("全部"!==this.selectedCategory&&(e=e.filter((e=>e.category&&e.category.includes(this.selectedCategory)||e.type&&e.type.includes(this.selectedCategory)))),this.searchQuery){const a=this.searchQuery.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(a)||e.address&&e.address.toLowerCase().includes(a)))}const a=(this.page-1)*this.pageSize,t=a+this.pageSize;return e.slice(a,t)}},mounted(){this.initMap()},methods:{initMap(){window.AMap?this.createMap():this.loadAMapScript().then((()=>{this.createMap()})).catch((e=>{console.error("加载地图API失败:",e),this.mapLoaded=!0}))},loadAMapScript(){return new Promise(((e,a)=>{const t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://webapi.amap.com/maps?v=2.0&key=您的高德地图key",t.onerror=a,t.onload=e,document.head.appendChild(t)}))},createMap(){try{this.map=new AMap.Map("map-container",{zoom:15,viewMode:"3D"}),this.map.plugin(["AMap.ToolBar","AMap.Scale"],(()=>{this.map.addControl(new AMap.ToolBar),this.map.addControl(new AMap.Scale)})),this.map.plugin("AMap.Geolocation",(()=>{this.geolocation=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,zoomToAccuracy:!0}),this.map.addControl(this.geolocation),this.getCurrentPosition()})),this.mapLoaded=!0}catch(e){console.error("创建地图失败:",e),this.mapLoaded=!0}},getCurrentPosition(){this.geolocation&&this.geolocation.getCurrentPosition(((e,a)=>{if("complete"===e){this.currentPosition=a.position;const e=new AMap.Marker({position:this.currentPosition,icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",animation:"AMAP_ANIMATION_BOUNCE"});this.map.add(e),this.map.setCenter(this.currentPosition),this.searchNearbyPOI()}else console.error("定位失败:",a),this.currentPosition=[116.351013,39.980331],this.map.setCenter(this.currentPosition)}))},searchNearbyPOI(){if(this.currentPosition){this.loading=!0;try{AMap.service("AMap.PlaceSearch",(()=>{const e=new AMap.PlaceSearch({pageSize:20,pageIndex:1,extensions:"all"});e.searchNearBy("",this.currentPosition,1e3,((e,a)=>{this.loading=!1,"complete"===e?(this.nearbyPlaces=a.poiList.pois.map((e=>{const a=AMap.GeometryUtil.distance(this.currentPosition,[e.location.lng,e.location.lat]);let t="";return t=a<1e3?`${Math.round(a)}米`:`${(a/1e3).toFixed(1)}公里`,{id:e.id,name:e.name,type:e.type,address:e.address,distance:t,location:[e.location.lng,e.location.lat]}})),this.addMarkersToMap(this.nearbyPlaces)):(console.error("搜索附近地点失败:",a),this.nearbyPlaces=this.mockPlaces,this.addMarkersToMap(this.mockPlaces))}))}))}catch(e){console.error("搜索附近POI失败:",e),this.loading=!1,this.nearbyPlaces=this.mockPlaces,this.addMarkersToMap(this.mockPlaces)}}},addMarkersToMap(e){if(this.map){if(this.map.clearMap(),this.currentPosition){const e=new AMap.Marker({position:this.currentPosition,icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",animation:"AMAP_ANIMATION_BOUNCE"});this.map.add(e)}e.forEach((e=>{if(e.location){const a=new AMap.Marker({position:e.location,title:e.name});a.on("click",(()=>{const a=new AMap.InfoWindow({content:`\n                <div class="info-window">\n                  <h3>${e.name}</h3>\n                  <p>${e.address||""}</p>\n                  <p>距离: ${e.distance}</p>\n                </div>\n              `,offset:new AMap.Pixel(0,-30)});a.open(this.map,e.location)})),this.map.add(a)}}))}},searchPlaces(){if(this.loading=!0,this.map&&this.currentPosition)try{AMap.service("AMap.PlaceSearch",(()=>{const e=new AMap.PlaceSearch({pageSize:20,pageIndex:1,extensions:"all"});e.searchNearBy(this.searchQuery,this.currentPosition,5e3,((e,a)=>{this.loading=!1,"complete"===e?(this.nearbyPlaces=a.poiList.pois.map((e=>{const a=AMap.GeometryUtil.distance(this.currentPosition,[e.location.lng,e.location.lat]);let t="";return t=a<1e3?`${Math.round(a)}米`:`${(a/1e3).toFixed(1)}公里`,{id:e.id,name:e.name,type:e.type,address:e.address,distance:t,location:[e.location.lng,e.location.lat]}})),this.addMarkersToMap(this.nearbyPlaces),this.page=1):console.error("搜索地点失败:",a)}))}))}catch(e){console.error("搜索地点失败:",e),this.loading=!1}else setTimeout((()=>{if(this.loading=!1,this.searchQuery){const e=this.searchQuery.toLowerCase();this.nearbyPlaces=this.mockPlaces.filter((a=>a.name.toLowerCase().includes(e)))}else this.nearbyPlaces=this.mockPlaces;this.page=1}),1e3)},getCategoryIcon(e){const a={"餐厅":"mdi-food","咖啡店":"mdi-coffee","超市":"mdi-store","公园":"mdi-nature","学校":"mdi-school","图书馆":"mdi-library","交通":"mdi-train","购物":"mdi-shopping","美食":"mdi-food-fork-drink","酒店":"mdi-bed","银行":"mdi-bank","医院":"mdi-hospital-building"};if(e){const a=e.toLowerCase();if(a.includes("餐"))return"mdi-food";if(a.includes("咖啡"))return"mdi-coffee";if(a.includes("超市")||a.includes("商场"))return"mdi-store";if(a.includes("公园"))return"mdi-nature";if(a.includes("学校")||a.includes("教育"))return"mdi-school";if(a.includes("图书馆"))return"mdi-library";if(a.includes("地铁")||a.includes("交通")||a.includes("公交"))return"mdi-train";if(a.includes("购物")||a.includes("商店"))return"mdi-shopping";if(a.includes("酒店")||a.includes("宾馆"))return"mdi-bed";if(a.includes("银行")||a.includes("金融"))return"mdi-bank";if(a.includes("医院")||a.includes("诊所"))return"mdi-hospital-building"}return a[e]||"mdi-map-marker"},getDirections(e){if(this.currentPosition&&e.location){const a=`https://uri.amap.com/navigation?from=${this.currentPosition.join(",")},我的位置&to=${e.location.join(",")},${e.name}&mode=car&policy=1&src=mypage&callnative=1`;window.open(a,"_blank")}else console.log(`获取到 ${e.name} 的导航信息`),alert(`导航到: ${e.name}\n地址: ${e.address||"未知地址"}`)},handlePageChange(e){this.page!==e&&(this.page=e,setTimeout((()=>{window.scrollTo({top:0,behavior:"smooth"})}),10))}}},L=t(6262);const F=(0,L.A)(w,[["render",_],["__scopeId","data-v-7e970692"]]);var x=F},236:function(e,a,t){t.d(a,{l:function(){return F}});t(1454);var i=t(641),n=t(3892),l=t(8353),s=t(9923),o=t(9262),r=t(2858),c=t(2191),d=t(7018),u=t(5965),p=t(5296),m=t(2067),h=t(953);function v(){const e=(0,h.KR)([]);function a(a,t){e.value[t]=a}return(0,i.Ic)((()=>e.value=[])),{refs:e,updateRef:a}}var g=t(5399),f=t(3240),b=t(3378),y=t(4663),k=t(7664),P=t(2428),M=t(4587),A=t(1247),_=t(9094),w=t(4600);const L=(0,M.j)({activeColor:String,start:{type:[Number,String],default:1},modelValue:{type:Number,default:e=>e.start},disabled:Boolean,length:{type:[Number,String],default:1,validator:e=>e%1===0},totalVisible:[Number,String],firstIcon:{type:u.TX,default:"$first"},prevIcon:{type:u.TX,default:"$prev"},nextIcon:{type:u.TX,default:"$next"},lastIcon:{type:u.TX,default:"$last"},ariaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.root"},pageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.page"},currentPageAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.currentPage"},firstAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.first"},previousAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.previous"},nextAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.next"},lastAriaLabel:{type:String,default:"$vuetify.pagination.ariaLabel.last"},ellipsis:{type:String,default:"..."},showFirstLastPage:Boolean,...(0,s.r)(),...(0,o.u)(),...(0,c.r)(),...(0,d.s)(),...(0,f.S)(),...(0,b.k)(),...(0,y.X)({tag:"nav"}),...(0,k.yx)(),...(0,P.gI)({variant:"text"})},"VPagination"),F=(0,A.RW)()({name:"VPagination",props:L(),emits:{"update:modelValue":e=>!0,first:e=>!0,prev:e=>!0,next:e=>!0,last:e=>!0},setup(e,a){let{slots:t,emit:s}=a;const o=(0,m.q)(e,"modelValue"),{t:c,n:d}=(0,p.Ym)(),{isRtl:u}=(0,p.IA)(),{themeClasses:f}=(0,k.NX)(e),{width:b}=(0,l._F)(),y=(0,h.IJ)(-1);(0,r.Uh)(void 0,{scoped:!0});const{resizeRef:P}=(0,g.w)((e=>{if(!e.length)return;const{target:a,contentRect:t}=e[0],i=a.querySelector(".v-pagination__list > *");if(!i)return;const n=t.width,l=i.offsetWidth+2*parseFloat(getComputedStyle(i).marginRight);y.value=F(n,l)})),M=(0,i.EW)((()=>parseInt(e.length,10))),A=(0,i.EW)((()=>parseInt(e.start,10))),L=(0,i.EW)((()=>null!=e.totalVisible?parseInt(e.totalVisible,10):y.value>=0?y.value:F(b.value,58)));function F(a,t){const i=e.showFirstLastPage?5:3;return Math.max(0,Math.floor(+((a-t*i)/t).toFixed(2)))}const x=(0,i.EW)((()=>{if(M.value<=0||isNaN(M.value)||M.value>Number.MAX_SAFE_INTEGER)return[];if(L.value<=0)return[];if(1===L.value)return[o.value];if(M.value<=L.value)return(0,_.Sd)(M.value,A.value);const a=L.value%2===0,t=a?L.value/2:Math.floor(L.value/2),i=a?t:t+1,n=M.value-t;if(i-o.value>=0)return[...(0,_.Sd)(Math.max(1,L.value-1),A.value),e.ellipsis,M.value];if(o.value-n>=(a?1:0)){const a=L.value-1,t=M.value-a+A.value;return[A.value,e.ellipsis,...(0,_.Sd)(a,t)]}{const a=Math.max(1,L.value-3),t=1===a?o.value:o.value-Math.ceil(a/2)+A.value;return[A.value,e.ellipsis,...(0,_.Sd)(a,t),e.ellipsis,M.value]}}));function C(e,a,t){e.preventDefault(),o.value=a,t&&s(t,a)}const{refs:I,updateRef:S}=v();(0,r.Uh)({VPaginationBtn:{color:(0,h.lW)(e,"color"),border:(0,h.lW)(e,"border"),density:(0,h.lW)(e,"density"),size:(0,h.lW)(e,"size"),variant:(0,h.lW)(e,"variant"),rounded:(0,h.lW)(e,"rounded"),elevation:(0,h.lW)(e,"elevation")}});const $=(0,i.EW)((()=>x.value.map(((a,t)=>{const i=e=>S(e,t);if("string"===typeof a)return{isActive:!1,key:`ellipsis-${t}`,page:a,props:{ref:i,ellipsis:!0,icon:!0,disabled:!0}};{const t=a===o.value;return{isActive:t,key:a,page:d(a),props:{ref:i,ellipsis:!1,icon:!0,disabled:!!e.disabled||+e.length<2,color:t?e.activeColor:e.color,"aria-current":t,"aria-label":c(t?e.currentPageAriaLabel:e.pageAriaLabel,a),onClick:e=>C(e,a)}}}})))),V=(0,i.EW)((()=>{const a=!!e.disabled||o.value<=A.value,t=!!e.disabled||o.value>=A.value+M.value-1;return{first:e.showFirstLastPage?{icon:u.value?e.lastIcon:e.firstIcon,onClick:e=>C(e,A.value,"first"),disabled:a,"aria-label":c(e.firstAriaLabel),"aria-disabled":a}:void 0,prev:{icon:u.value?e.nextIcon:e.prevIcon,onClick:e=>C(e,o.value-1,"prev"),disabled:a,"aria-label":c(e.previousAriaLabel),"aria-disabled":a},next:{icon:u.value?e.prevIcon:e.nextIcon,onClick:e=>C(e,o.value+1,"next"),disabled:t,"aria-label":c(e.nextAriaLabel),"aria-disabled":t},last:e.showFirstLastPage?{icon:u.value?e.firstIcon:e.lastIcon,onClick:e=>C(e,A.value+M.value-1,"last"),disabled:t,"aria-label":c(e.lastAriaLabel),"aria-disabled":t}:void 0}}));function W(){const e=o.value-A.value;I.value[e]?.$el.focus()}function N(a){a.key===_.K7.left&&!e.disabled&&o.value>+e.start?(o.value=o.value-1,(0,i.dY)(W)):a.key===_.K7.right&&!e.disabled&&o.value<A.value+M.value-1&&(o.value=o.value+1,(0,i.dY)(W))}return(0,w.C)((()=>(0,i.bF)(e.tag,{ref:P,class:["v-pagination",f.value,e.class],style:e.style,role:"navigation","aria-label":c(e.ariaLabel),onKeydown:N,"data-test":"v-pagination-root"},{default:()=>[(0,i.bF)("ul",{class:"v-pagination__list"},[e.showFirstLastPage&&(0,i.bF)("li",{key:"first",class:"v-pagination__first","data-test":"v-pagination-first"},[t.first?t.first(V.value.first):(0,i.bF)(n.D,(0,i.v6)({_as:"VPaginationBtn"},V.value.first),null)]),(0,i.bF)("li",{key:"prev",class:"v-pagination__prev","data-test":"v-pagination-prev"},[t.prev?t.prev(V.value.prev):(0,i.bF)(n.D,(0,i.v6)({_as:"VPaginationBtn"},V.value.prev),null)]),$.value.map(((e,a)=>(0,i.bF)("li",{key:e.key,class:["v-pagination__item",{"v-pagination__item--is-active":e.isActive}],"data-test":"v-pagination-item"},[t.item?t.item(e):(0,i.bF)(n.D,(0,i.v6)({_as:"VPaginationBtn"},e.props),{default:()=>[e.page]})]))),(0,i.bF)("li",{key:"next",class:"v-pagination__next","data-test":"v-pagination-next"},[t.next?t.next(V.value.next):(0,i.bF)(n.D,(0,i.v6)({_as:"VPaginationBtn"},V.value.next),null)]),e.showFirstLastPage&&(0,i.bF)("li",{key:"last",class:"v-pagination__last","data-test":"v-pagination-last"},[t.last?t.last(V.value.last):(0,i.bF)(n.D,(0,i.v6)({_as:"VPaginationBtn"},V.value.last),null)])])]}))),{}}})}}]);
//# sourceMappingURL=346.adb87128.js.map
"use strict";(self["webpackChunkbuaa_hzt"]=self["webpackChunkbuaa_hzt"]||[]).push([[346],{346:function(e,t,a){a.r(t),a.d(t,{default:function(){return x}});var i=a(641),n=a(3751),o=a(3416),s=a(3892),r=a(4189),l=a(1606),c=a(697),d=a(3813),p=a(6756),u=a(5526),m=a(9669),h=a(7009),g=a(7925),y=a(236),f=a(6106),b=a(8119),k=a(3948);const P={class:"map-container mb-4"},M={key:0,class:"d-flex justify-center align-center flex-column",style:{height:"300px"}},w={class:"d-flex justify-center my-4"},A={class:"d-flex justify-center pa-4"};function C(e,t,a,C,v,_){return(0,i.uX)(),(0,i.Wv)(d.I,null,{default:(0,i.k6)((()=>[(0,i.bF)(r.J,{class:"mb-4"},{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{start:"",icon:"mdi-map-marker",class:"mr-2"}),t[3]||(t[3]=(0,i.Lk)("h1",null,"附近地点",-1))])),_:1}),(0,i.bF)(c.O,null,{default:(0,i.k6)((()=>[(0,i.Lk)("div",P,[v.mapLoaded?(0,i.Q3)("",!0):((0,i.uX)(),(0,i.CE)("div",M,[(0,i.bF)(f.x,{indeterminate:"",color:"primary",size:"64"}),t[4]||(t[4]=(0,i.Lk)("div",{class:"mt-4"},"地图加载中...",-1))])),t[5]||(t[5]=(0,i.Lk)("div",{id:"map-container",style:{height:"300px","border-radius":"8px"}},null,-1))])])),_:1})])),_:1}),(0,i.bF)(r.J,{class:"mb-4"},{default:(0,i.k6)((()=>[(0,i.bF)(c.O,null,{default:(0,i.k6)((()=>[(0,i.bF)(p.L,{align:"center"},{default:(0,i.k6)((()=>[(0,i.bF)(u.B,{cols:"12",sm:"8"},{default:(0,i.k6)((()=>[(0,i.bF)(k.W,{modelValue:v.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=e=>v.searchQuery=e),label:"搜索附近地点",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-magnify",clearable:"",onKeyup:(0,n.jR)(_.searchPlaces,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),(0,i.bF)(u.B,{cols:"12",sm:"4"},{default:(0,i.k6)((()=>[(0,i.bF)(b.d4,{modelValue:v.selectedCategory,"onUpdate:modelValue":t[1]||(t[1]=e=>v.selectedCategory=e),items:v.categories,label:"分类",variant:"outlined",density:"comfortable","prepend-inner-icon":"mdi-filter-variant"},null,8,["modelValue","items"])])),_:1})])),_:1})])),_:1})])),_:1}),(0,i.bF)(r.J,null,{default:(0,i.k6)((()=>[(0,i.bF)(l.r,{class:"d-flex align-center"},{default:(0,i.k6)((()=>[(0,i.bF)(m.w,{start:"",icon:"mdi-format-list-bulleted",class:"mr-2"}),t[6]||(t[6]=(0,i.eW)(" 附近地点列表 "))])),_:1}),v.loading?((0,i.uX)(),(0,i.Wv)(c.O,{key:0},{default:(0,i.k6)((()=>[(0,i.Lk)("div",w,[(0,i.bF)(f.x,{indeterminate:"",color:"primary"})])])),_:1})):((0,i.uX)(),(0,i.CE)(i.FK,{key:1},[(0,i.bF)(h.x8,{lines:"two"},{default:(0,i.k6)((()=>[((0,i.uX)(!0),(0,i.CE)(i.FK,null,(0,i.pI)(_.filteredPlaces,((e,t)=>((0,i.uX)(),(0,i.Wv)(g.g,{key:t,title:e.name,subtitle:`${e.distance||"未知距离"} · ${e.category||e.type}`},{prepend:(0,i.k6)((()=>[(0,i.bF)(o.y,{color:"primary",icon:_.getCategoryIcon(e.category||e.type)},null,8,["icon"])])),append:(0,i.k6)((()=>[(0,i.bF)(s.D,{icon:"mdi-directions",variant:"text",color:"primary",onClick:t=>_.getDirections(e)},null,8,["onClick"])])),_:2},1032,["title","subtitle"])))),128))])),_:1}),(0,i.Lk)("div",A,[(0,i.bF)(y.l,{modelValue:v.page,"onUpdate:modelValue":[t[2]||(t[2]=e=>v.page=e),_.handlePageChange],length:Math.ceil(_.filteredPlaces.length/v.pageSize),rounded:"circle",width:"auto",class:"pagination-container"},null,8,["modelValue","length","onUpdate:modelValue"])])],64))])),_:1})])),_:1})}a(8992),a(4520),a(3949),a(1454);var v={data(){return{mapLoaded:!1,searchQuery:"",selectedCategory:"全部",categories:["全部","餐厅","咖啡店","超市","公园","学校","图书馆"],loading:!1,page:1,pageSize:6,map:null,geolocation:null,currentPosition:null,nearbyPlaces:[],mockPlaces:[{name:"北航食堂",distance:"200米",category:"餐厅",location:[116.351462,39.980476]},{name:"星巴克咖啡",distance:"350米",category:"咖啡店",location:[116.349784,39.98231]},{name:"学生活动中心",distance:"500米",category:"学校",location:[116.353103,39.979854]},{name:"知春路地铁站",distance:"800米",category:"交通",location:[116.347854,39.976549]},{name:"北航图书馆",distance:"400米",category:"图书馆",location:[116.350678,39.981236]},{name:"五道口购物中心",distance:"1.2公里",category:"购物",location:[116.338963,39.991255]}]}},computed:{filteredPlaces(){let e=this.nearbyPlaces.length>0?this.nearbyPlaces:this.mockPlaces;if("全部"!==this.selectedCategory&&(e=e.filter((e=>e.category&&e.category.includes(this.selectedCategory)||e.type&&e.type.includes(this.selectedCategory)))),this.searchQuery){const t=this.searchQuery.toLowerCase();e=e.filter((e=>e.name.toLowerCase().includes(t)||e.address&&e.address.toLowerCase().includes(t)))}const t=(this.page-1)*this.pageSize,a=t+this.pageSize;return e.slice(t,a)}},mounted(){this.initMap()},methods:{initMap(){window.AMap?this.createMap():this.loadAMapScript().then((()=>{this.createMap()})).catch((e=>{console.error("加载地图API失败:",e),this.mapLoaded=!0}))},loadAMapScript(){return new Promise(((e,t)=>{const a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="https://webapi.amap.com/maps?v=2.0&key=您的高德地图key",a.onerror=t,a.onload=e,document.head.appendChild(a)}))},createMap(){try{this.map=new AMap.Map("map-container",{zoom:15,viewMode:"3D"}),this.map.plugin(["AMap.ToolBar","AMap.Scale"],(()=>{this.map.addControl(new AMap.ToolBar),this.map.addControl(new AMap.Scale)})),this.map.plugin("AMap.Geolocation",(()=>{this.geolocation=new AMap.Geolocation({enableHighAccuracy:!0,timeout:1e4,zoomToAccuracy:!0}),this.map.addControl(this.geolocation),this.getCurrentPosition()})),this.mapLoaded=!0}catch(e){console.error("创建地图失败:",e),this.mapLoaded=!0}},getCurrentPosition(){this.geolocation&&this.geolocation.getCurrentPosition(((e,t)=>{if("complete"===e){this.currentPosition=t.position;const e=new AMap.Marker({position:this.currentPosition,icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",animation:"AMAP_ANIMATION_BOUNCE"});this.map.add(e),this.map.setCenter(this.currentPosition),this.searchNearbyPOI()}else console.error("定位失败:",t),this.currentPosition=[116.351013,39.980331],this.map.setCenter(this.currentPosition)}))},searchNearbyPOI(){if(this.currentPosition){this.loading=!0;try{AMap.service("AMap.PlaceSearch",(()=>{const e=new AMap.PlaceSearch({pageSize:20,pageIndex:1,extensions:"all"});e.searchNearBy("",this.currentPosition,1e3,((e,t)=>{this.loading=!1,"complete"===e?(this.nearbyPlaces=t.poiList.pois.map((e=>{const t=AMap.GeometryUtil.distance(this.currentPosition,[e.location.lng,e.location.lat]);let a="";return a=t<1e3?`${Math.round(t)}米`:`${(t/1e3).toFixed(1)}公里`,{id:e.id,name:e.name,type:e.type,address:e.address,distance:a,location:[e.location.lng,e.location.lat]}})),this.addMarkersToMap(this.nearbyPlaces)):(console.error("搜索附近地点失败:",t),this.nearbyPlaces=this.mockPlaces,this.addMarkersToMap(this.mockPlaces))}))}))}catch(e){console.error("搜索附近POI失败:",e),this.loading=!1,this.nearbyPlaces=this.mockPlaces,this.addMarkersToMap(this.mockPlaces)}}},addMarkersToMap(e){if(this.map){if(this.map.clearMap(),this.currentPosition){const e=new AMap.Marker({position:this.currentPosition,icon:"https://webapi.amap.com/theme/v1.3/markers/n/mark_b.png",animation:"AMAP_ANIMATION_BOUNCE"});this.map.add(e)}e.forEach((e=>{if(e.location){const t=new AMap.Marker({position:e.location,title:e.name});t.on("click",(()=>{const t=new AMap.InfoWindow({content:`\n                <div class="info-window">\n                  <h3>${e.name}</h3>\n                  <p>${e.address||""}</p>\n                  <p>距离: ${e.distance}</p>\n                </div>\n              `,offset:new AMap.Pixel(0,-30)});t.open(this.map,e.location)})),this.map.add(t)}}))}},searchPlaces(){if(this.loading=!0,this.map&&this.currentPosition)try{AMap.service("AMap.PlaceSearch",(()=>{const e=new AMap.PlaceSearch({pageSize:20,pageIndex:1,extensions:"all"});e.searchNearBy(this.searchQuery,this.currentPosition,5e3,((e,t)=>{this.loading=!1,"complete"===e?(this.nearbyPlaces=t.poiList.pois.map((e=>{const t=AMap.GeometryUtil.distance(this.currentPosition,[e.location.lng,e.location.lat]);let a="";return a=t<1e3?`${Math.round(t)}米`:`${(t/1e3).toFixed(1)}公里`,{id:e.id,name:e.name,type:e.type,address:e.address,distance:a,location:[e.location.lng,e.location.lat]}})),this.addMarkersToMap(this.nearbyPlaces),this.page=1):console.error("搜索地点失败:",t)}))}))}catch(e){console.error("搜索地点失败:",e),this.loading=!1}else setTimeout((()=>{if(this.loading=!1,this.searchQuery){const e=this.searchQuery.toLowerCase();this.nearbyPlaces=this.mockPlaces.filter((t=>t.name.toLowerCase().includes(e)))}else this.nearbyPlaces=this.mockPlaces;this.page=1}),1e3)},getCategoryIcon(e){const t={"餐厅":"mdi-food","咖啡店":"mdi-coffee","超市":"mdi-store","公园":"mdi-nature","学校":"mdi-school","图书馆":"mdi-library","交通":"mdi-train","购物":"mdi-shopping","美食":"mdi-food-fork-drink","酒店":"mdi-bed","银行":"mdi-bank","医院":"mdi-hospital-building"};if(e){const t=e.toLowerCase();if(t.includes("餐"))return"mdi-food";if(t.includes("咖啡"))return"mdi-coffee";if(t.includes("超市")||t.includes("商场"))return"mdi-store";if(t.includes("公园"))return"mdi-nature";if(t.includes("学校")||t.includes("教育"))return"mdi-school";if(t.includes("图书馆"))return"mdi-library";if(t.includes("地铁")||t.includes("交通")||t.includes("公交"))return"mdi-train";if(t.includes("购物")||t.includes("商店"))return"mdi-shopping";if(t.includes("酒店")||t.includes("宾馆"))return"mdi-bed";if(t.includes("银行")||t.includes("金融"))return"mdi-bank";if(t.includes("医院")||t.includes("诊所"))return"mdi-hospital-building"}return t[e]||"mdi-map-marker"},getDirections(e){if(this.currentPosition&&e.location){const t=`https://uri.amap.com/navigation?from=${this.currentPosition.join(",")},我的位置&to=${e.location.join(",")},${e.name}&mode=car&policy=1&src=mypage&callnative=1`;window.open(t,"_blank")}else console.log(`获取到 ${e.name} 的导航信息`),alert(`导航到: ${e.name}\n地址: ${e.address||"未知地址"}`)},handlePageChange(e){this.page!==e&&(this.page=e,setTimeout((()=>{window.scrollTo({top:0,behavior:"smooth"})}),10))}}},_=a(6262);const F=(0,_.A)(v,[["render",C],["__scopeId","data-v-7e970692"]]);var x=F}}]);
//# sourceMappingURL=346.4e3bfe29.js.map